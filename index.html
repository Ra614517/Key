<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Dark Elo Premium</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;800&display=swap');
        :root { --blue: #007aff; --bg: #ffffff; --card: #f2f2f7; }
        body { background: var(--bg); color: #000; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 20px; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .logo { font-weight: 800; font-size: 22px; color: var(--blue); letter-spacing: -1px; }

        /* Balance Card */
        .balance-card { background: var(--card); padding: 30px; border-radius: 28px; text-align: center; margin-bottom: 25px; }
        .token-val { font-size: 3.5rem; font-weight: 800; margin: 10px 0; color: #000; }
        
        .btn { background: var(--blue); color: white; border: none; padding: 18px; border-radius: 20px; font-weight: 700; width: 100%; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.2s; }
        .btn-green { background: #34c759; }

        /* Full Screen Ad Overlay */
        #videoOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; }
        #adFrame { width: 100%; height: 100%; border: none; }
        
        /* Left-Side Compact Timer */
        .status-badge { 
            position: absolute; top: 20px; left: 20px; 
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 8px 15px; border-radius: 12px; font-weight: 700; font-size: 13px;
            display: flex; align-items: center; gap: 8px; border: 1px solid rgba(0,0,0,0.1);
        }
        .dot { width: 8px; height: 8px; background: #ff3b30; border-radius: 50%; }
        
        /* Cancel Button (Hidden at start) */
        #closeBtn { 
            display: none; position: absolute; top: 18px; left: 20px; 
            background: #ff3b30; color: white; border: none; 
            padding: 10px 20px; border-radius: 12px; font-weight: 700; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">DARK ELO.</div>
        <div style="font-size: 12px; opacity: 0.5;">PREMIUM ACCESS</div>
    </div>

    <div class="balance-card">
        <span style="opacity: 0.5; font-weight: 700; font-size: 14px;">YOUR TOKENS</span>
        <div class="token-val" id="tokenDisplay">0</div>
        <button class="btn" onclick="openVideo()">Watch Video Task</button>
    </div>

    <div style="margin-top: 30px;">
        <h3 style="font-weight: 800; margin-left: 10px;">Redeem</h3>
        <button class="btn btn-green" onclick="buy(8, '4h')">8 Tokens - 4 Hrs</button>
        <button class="btn btn-green" onclick="buy(15, '9h')">15 Tokens - 9 Hrs</button>
        <button class="btn btn-green" onclick="buy(25, '1d')">25 Tokens - 1 Day</button>
        <div id="res" style="display:none; margin-top:15px; padding:20px; background:var(--card); border-radius:20px; font-family:monospace; border:1px solid #ddd;"></div>
    </div>

    <div id="videoOverlay">
        <div id="statusBadge" class="status-badge">
            <div class="dot"></div>
            <span id="timerText">Verifying: 30s</span>
        </div>
        <button id="closeBtn" onclick="closeVideo()">âœ• Close & Claim</button>
        <iframe id="adFrame" src=""></iframe>
    </div>

    <script>
        let tokens = parseInt(localStorage.getItem('user_tokens')) || 0;
        document.getElementById('tokenDisplay').innerText = tokens;
        let timeLeft = 30;
        let timerId = null;

        // Security: Back button cancels task
        history.pushState(null, null, location.href);
        window.onpopstate = function() {
            if (timerId) {
                forceCancel();
                alert("Task Cancelled: Back button detected!");
            }
        };

        function forceCancel() {
            clearInterval(timerId);
            timerId = null;
            document.getElementById('videoOverlay').style.display = "none";
            document.getElementById('adFrame').src = "";
        }

        function openVideo() {
            const adUrl = "https://www.effectivegatecpm.com/b70wi46r?key=4c9a27caa81b5b0c8faea402cdb73661";
            document.getElementById('adFrame').src = adUrl;
            document.getElementById('videoOverlay').style.display = "block";
            document.getElementById('statusBadge').style.display = "flex";
            document.getElementById('closeBtn').style.display = "none";
            
            timeLeft = 30;
            timerId = setInterval(() => {
                if (document.hidden) { forceCancel(); alert("FAILED: Don't leave!"); return; }
                timeLeft--;
                document.getElementById('timerText').innerText = "Verifying: " + timeLeft + "s";
                if (timeLeft <= 0) {
                    clearInterval(timerId);
                    document.getElementById('statusBadge').style.display = "none";
                    document.getElementById('closeBtn').style.display = "block";
                }
            }, 1000);
        }

        function closeVideo() {
            document.getElementById('videoOverlay').style.display = "none";
            document.getElementById('adFrame').src = "";
            tokens++;
            localStorage.setItem('user_tokens', tokens);
            document.getElementById('tokenDisplay').innerText = tokens;
            timerId = null;
        }

        function buy(cost, time) {
            if (tokens >= cost) {
                tokens -= cost;
                localStorage.setItem('user_tokens', tokens);
                document.getElementById('tokenDisplay').innerText = tokens;
                let k = "ELO-" + Math.random().toString(36).substr(2, 6).toUpperCase();